<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DMAP ë¼ì´ë¸ŒëŸ¬ë¦¬ í…ŒìŠ¤íŠ¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        h1 {
            color: #2196F3;
            margin-bottom: 20px;
            border-bottom: 2px solid #2196F3;
            padding-bottom: 10px;
        }

        h2 {
            color: #333;
            margin-top: 30px;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .status-item {
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #ccc;
        }

        .status-item.success {
            background: #e8f5e9;
            border-color: #4caf50;
        }

        .status-item.error {
            background: #ffebee;
            border-color: #f44336;
        }

        .status-item.loading {
            background: #fff3e0;
            border-color: #ff9800;
        }

        .status-item h3 {
            margin-bottom: 8px;
            font-size: 14px;
            color: #666;
        }

        .status-item p {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #2196F3;
            color: white;
        }

        .btn-primary:hover {
            background: #1976D2;
        }

        .btn-secondary {
            background: #FF9800;
            color: white;
        }

        .btn-secondary:hover {
            background: #F57C00;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background: #d32f2f;
        }

        #console {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .log-entry {
            margin-bottom: 8px;
            padding: 4px 0;
            border-bottom: 1px solid #333;
        }

        .log-time {
            color: #858585;
            margin-right: 10px;
        }

        .log-info {
            color: #4fc3f7;
        }

        .log-success {
            color: #81c784;
        }

        .log-error {
            color: #e57373;
        }

        .log-warn {
            color: #ffb74d;
        }

        #viewer {
            width: 100%;
            height: 500px;
            background: #1a1a1a;
            border-radius: 6px;
            margin-top: 20px;
            position: relative;
        }

        #viewerCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .file-upload {
            margin: 20px 0;
            padding: 20px;
            border: 2px dashed #ccc;
            border-radius: 6px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .file-upload:hover {
            border-color: #2196F3;
            background: #f0f8ff;
        }

        .file-upload input {
            display: none;
        }

        .version-info {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
        }

        .version-info pre {
            background: white;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }

        .clear-console {
            float: right;
            padding: 5px 15px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .clear-console:hover {
            background: #d32f2f;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” DMAP ë¼ì´ë¸ŒëŸ¬ë¦¬ & DXF ë¡œë”© í…ŒìŠ¤íŠ¸</h1>
        
        <div class="button-group">
            <button class="btn-primary" onclick="testAll()">ğŸ§ª ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
            <button class="btn-secondary" onclick="clearCache()">ğŸ—‘ï¸ ìºì‹œ ì‚­ì œ & ìƒˆë¡œê³ ì¹¨</button>
            <button class="btn-secondary" onclick="testLibraries()">ğŸ“š ë¼ì´ë¸ŒëŸ¬ë¦¬ë§Œ í…ŒìŠ¤íŠ¸</button>
            <button class="btn-danger" onclick="location.reload()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        </div>

        <h2>ğŸ“Š ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë”© ìƒíƒœ</h2>
        <div class="status" id="libraryStatus">
            <div class="status-item loading">
                <h3>Three.js</h3>
                <p id="threeStatus">í™•ì¸ ì¤‘...</p>
            </div>
            <div class="status-item loading">
                <h3>three-dxf</h3>
                <p id="dxfStatus">í™•ì¸ ì¤‘...</p>
            </div>
            <div class="status-item loading">
                <h3>Google Identity Services</h3>
                <p id="googleStatus">í™•ì¸ ì¤‘...</p>
            </div>
        </div>

        <h2>ğŸ“ DXF íŒŒì¼ í…ŒìŠ¤íŠ¸</h2>
        <div class="file-upload" onclick="document.getElementById('dxfInput').click()">
            <p>ğŸ“„ DXF íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì„¸ìš”</p>
            <input type="file" id="dxfInput" accept=".dxf" onchange="loadDxfFile(this.files[0])">
        </div>

        <h2>ğŸ–¥ï¸ ì½˜ì†” ë¡œê·¸</h2>
        <button class="clear-console" onclick="clearConsole()">ë¡œê·¸ ì§€ìš°ê¸°</button>
        <div id="console"></div>

        <div id="viewer" style="display: none;">
            <canvas id="viewerCanvas"></canvas>
        </div>

        <div class="version-info">
            <h2>ğŸ“‹ ì‹œìŠ¤í…œ ì •ë³´</h2>
            <pre id="systemInfo">ë¡œë”© ì¤‘...</pre>
        </div>
    </div>

    <!-- Three.js -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.min.js"></script>
    
    <!-- three-dxf -->
    <script src="https://cdn.jsdelivr.net/npm/three-dxf@3.1.6/dist/three-dxf.umd.js"></script>
    
    <!-- Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <script>
        // ìºì‹œ ë²„ìŠ¤íŒ…ì„ ìœ„í•œ íƒ€ì„ìŠ¤íƒ¬í”„
        const CACHE_VERSION = Date.now();
        
        // ì»¤ìŠ¤í…€ ì½˜ì†” ë¡œê·¸
        const consoleElement = document.getElementById('console');
        const originalConsole = {
            log: console.log,
            error: console.error,
            warn: console.warn,
            info: console.info
        };

        function logToConsole(message, type = 'info') {
            const time = new Date().toLocaleTimeString('ko-KR');
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            
            logEntry.innerHTML = `
                <span class="log-time">[${time}]</span>
                <span class="log-${type}">${escapeHtml(String(message))}</span>
            `;
            
            consoleElement.appendChild(logEntry);
            consoleElement.scrollTop = consoleElement.scrollHeight;
            
            // ì›ë³¸ ì½˜ì†”ì—ë„ ì¶œë ¥
            if (type === 'error') {
                originalConsole.error(message);
            } else if (type === 'warn') {
                originalConsole.warn(message);
            } else {
                originalConsole.log(message);
            }
        }

        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        function clearConsole() {
            consoleElement.innerHTML = '';
            logToConsole('ì½˜ì†”ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        }

        // ì½˜ì†” ì˜¤ë²„ë¼ì´ë“œ
        console.log = function(...args) {
            logToConsole(args.join(' '), 'info');
        };
        console.error = function(...args) {
            logToConsole(args.join(' '), 'error');
        };
        console.warn = function(...args) {
            logToConsole(args.join(' '), 'warn');
        };
        console.info = function(...args) {
            logToConsole(args.join(' '), 'info');
        };

        // ìºì‹œ ì‚­ì œ
        async function clearCache() {
            try {
                logToConsole('ğŸ—‘ï¸ ìºì‹œ ì‚­ì œ ì¤‘...', 'info');
                
                // Service Worker ìºì‹œ ì‚­ì œ
                if ('caches' in window) {
                    const cacheNames = await caches.keys();
                    await Promise.all(
                        cacheNames.map(cacheName => caches.delete(cacheName))
                    );
                    logToConsole(`âœ“ ${cacheNames.length}ê°œì˜ ìºì‹œ ì‚­ì œë¨`, 'success');
                }
                
                // LocalStorage ì‚­ì œ
                localStorage.clear();
                logToConsole('âœ“ LocalStorage ì‚­ì œë¨', 'success');
                
                // SessionStorage ì‚­ì œ
                sessionStorage.clear();
                logToConsole('âœ“ SessionStorage ì‚­ì œë¨', 'success');
                
                logToConsole('ğŸ”„ 3ì´ˆ í›„ ìƒˆë¡œê³ ì¹¨...', 'info');
                setTimeout(() => {
                    location.reload(true);
                }, 3000);
                
            } catch (error) {
                logToConsole('âŒ ìºì‹œ ì‚­ì œ ì‹¤íŒ¨: ' + error.message, 'error');
            }
        }

        // ë¼ì´ë¸ŒëŸ¬ë¦¬ í…ŒìŠ¤íŠ¸
        async function testLibraries() {
            logToConsole('=== ë¼ì´ë¸ŒëŸ¬ë¦¬ í…ŒìŠ¤íŠ¸ ì‹œì‘ ===', 'info');
            
            // Three.js í…ŒìŠ¤íŠ¸
            const threeStatus = document.getElementById('threeStatus');
            const threeItem = threeStatus.closest('.status-item');
            
            if (typeof THREE !== 'undefined') {
                threeStatus.textContent = `âœ“ ë¡œë“œë¨ (r${THREE.REVISION})`;
                threeItem.className = 'status-item success';
                logToConsole(`âœ“ Three.js ë¡œë“œ ì„±ê³µ: r${THREE.REVISION}`, 'success');
                
                // ê¸°ë³¸ Three.js ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
                try {
                    const scene = new THREE.Scene();
                    const camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
                    logToConsole('âœ“ Three.js Scene/Camera ìƒì„± ì„±ê³µ', 'success');
                } catch (e) {
                    logToConsole('âŒ Three.js ê¸°ëŠ¥ ì˜¤ë¥˜: ' + e.message, 'error');
                }
            } else {
                threeStatus.textContent = 'âŒ ë¡œë“œ ì‹¤íŒ¨';
                threeItem.className = 'status-item error';
                logToConsole('âŒ Three.js ë¡œë“œ ì‹¤íŒ¨ - CDN í™•ì¸ í•„ìš”', 'error');
            }
            
            // three-dxf í…ŒìŠ¤íŠ¸
            const dxfStatus = document.getElementById('dxfStatus');
            const dxfItem = dxfStatus.closest('.status-item');
            
            await new Promise(resolve => setTimeout(resolve, 500));
            
            if (typeof ThreeDxf !== 'undefined') {
                dxfStatus.textContent = 'âœ“ ë¡œë“œë¨';
                dxfItem.className = 'status-item success';
                logToConsole('âœ“ three-dxf ë¡œë“œ ì„±ê³µ', 'success');
                
                // three-dxf Parser í…ŒìŠ¤íŠ¸
                try {
                    const parser = new ThreeDxf.Parser();
                    logToConsole('âœ“ three-dxf Parser ìƒì„± ì„±ê³µ', 'success');
                    logToConsole('  Parser ë©”ì„œë“œ: ' + Object.keys(parser).join(', '), 'info');
                } catch (e) {
                    logToConsole('âŒ three-dxf Parser ìƒì„± ì‹¤íŒ¨: ' + e.message, 'error');
                }
            } else {
                dxfStatus.textContent = 'âŒ ë¡œë“œ ì‹¤íŒ¨';
                dxfItem.className = 'status-item error';
                logToConsole('âŒ three-dxf ë¡œë“œ ì‹¤íŒ¨ - CDN í™•ì¸ í•„ìš”', 'error');
                logToConsole('  window.ThreeDxf: ' + typeof window.ThreeDxf, 'warn');
            }
            
            // Google Identity Services í…ŒìŠ¤íŠ¸
            const googleStatus = document.getElementById('googleStatus');
            const googleItem = googleStatus.closest('.status-item');
            
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            if (typeof google !== 'undefined' && google.accounts) {
                googleStatus.textContent = 'âœ“ ë¡œë“œë¨';
                googleItem.className = 'status-item success';
                logToConsole('âœ“ Google Identity Services ë¡œë“œ ì„±ê³µ', 'success');
            } else {
                googleStatus.textContent = 'âš ï¸ ë¶€ë¶„ ë¡œë“œ (ì •ìƒ)';
                googleItem.className = 'status-item success';
                logToConsole('âš ï¸ Google Identity Services ì•„ì§ ë¡œë”© ì¤‘ (ë¹„ë™ê¸°)', 'warn');
            }
            
            logToConsole('=== ë¼ì´ë¸ŒëŸ¬ë¦¬ í…ŒìŠ¤íŠ¸ ì™„ë£Œ ===', 'info');
        }

        // DXF íŒŒì¼ ë¡œë“œ í…ŒìŠ¤íŠ¸
        async function loadDxfFile(file) {
            if (!file) {
                logToConsole('âŒ íŒŒì¼ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            logToConsole(`=== DXF íŒŒì¼ ë¡œë“œ ì‹œì‘: ${file.name} ===`, 'info');
            logToConsole(`  íŒŒì¼ í¬ê¸°: ${(file.size / 1024).toFixed(2)} KB`, 'info');
            
            try {
                // íŒŒì¼ ì½ê¸°
                logToConsole('1ï¸âƒ£ íŒŒì¼ ì½ê¸° ì‹œì‘...', 'info');
                const text = await file.text();
                logToConsole(`âœ“ íŒŒì¼ ì½ê¸° ì™„ë£Œ (${text.length} ë¬¸ì)`, 'success');
                logToConsole(`  ì²« 100ì: ${text.substring(0, 100)}...`, 'info');
                
                // three-dxf í™•ì¸
                if (typeof ThreeDxf === 'undefined') {
                    throw new Error('three-dxf ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                }
                
                // Parser ìƒì„±
                logToConsole('2ï¸âƒ£ three-dxf Parser ìƒì„±...', 'info');
                const parser = new ThreeDxf.Parser();
                logToConsole('âœ“ Parser ìƒì„± ì™„ë£Œ', 'success');
                
                // DXF íŒŒì‹±
                logToConsole('3ï¸âƒ£ DXF íŒŒì‹± ì‹œì‘...', 'info');
                const dxf = parser.parseSync(text);
                logToConsole('âœ“ DXF íŒŒì‹± ì™„ë£Œ', 'success');
                logToConsole(`  ì—”í‹°í‹° ìˆ˜: ${dxf.entities ? dxf.entities.length : 0}`, 'info');
                logToConsole(`  DXF êµ¬ì¡°: ${JSON.stringify(Object.keys(dxf), null, 2)}`, 'info');
                
                // Three.js ë Œë”ë§ í…ŒìŠ¤íŠ¸
                logToConsole('4ï¸âƒ£ Three.js ë Œë”ë§ í…ŒìŠ¤íŠ¸...', 'info');
                await renderDxf(dxf);
                
                logToConsole('=== DXF íŒŒì¼ ë¡œë“œ ì™„ë£Œ ===', 'success');
                
            } catch (error) {
                logToConsole('âŒ DXF ë¡œë“œ ì‹¤íŒ¨: ' + error.message, 'error');
                logToConsole('  ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤: ' + error.stack, 'error');
            }
        }

        // DXF ë Œë”ë§
        let renderer, scene, camera;
        
        async function renderDxf(dxfData) {
            try {
                const viewerDiv = document.getElementById('viewer');
                const canvas = document.getElementById('viewerCanvas');
                
                viewerDiv.style.display = 'block';
                
                // Scene ì„¤ì •
                scene = new THREE.Scene();
                scene.background = new THREE.Color(0x1a1a1a);
                logToConsole('âœ“ Three.js Scene ìƒì„±', 'success');
                
                // Camera ì„¤ì •
                camera = new THREE.OrthographicCamera(-100, 100, 100, -100, 0.1, 1000);
                camera.position.set(0, 0, 100);
                camera.lookAt(0, 0, 0);
                logToConsole('âœ“ Three.js Camera ìƒì„±', 'success');
                
                // Renderer ì„¤ì •
                if (!renderer) {
                    renderer = new THREE.WebGLRenderer({ 
                        canvas: canvas,
                        antialias: true 
                    });
                    renderer.setSize(canvas.clientWidth, canvas.clientHeight);
                    logToConsole('âœ“ Three.js Renderer ìƒì„±', 'success');
                }
                
                // ì¡°ëª…
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
                scene.add(ambientLight);
                
                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
                directionalLight.position.set(0, 0, 1);
                scene.add(directionalLight);
                
                // DXF ì—”í‹°í‹° ë Œë”ë§
                const group = new THREE.Group();
                let entityCount = 0;
                
                if (dxfData && dxfData.entities) {
                    logToConsole(`  ì²˜ë¦¬í•  ì—”í‹°í‹°: ${dxfData.entities.length}ê°œ`, 'info');
                    
                    dxfData.entities.forEach((entity, index) => {
                        try {
                            if (entity.vertices && entity.vertices.length > 0) {
                                const geometry = new THREE.BufferGeometry();
                                const positions = [];
                                
                                entity.vertices.forEach(vertex => {
                                    positions.push(vertex.x, vertex.y, vertex.z || 0);
                                });
                                
                                geometry.setAttribute('position', 
                                    new THREE.Float32BufferAttribute(positions, 3));
                                
                                const material = new THREE.LineBasicMaterial({ 
                                    color: entity.color || 0xffffff,
                                    linewidth: 1 
                                });
                                
                                const line = new THREE.Line(geometry, material);
                                group.add(line);
                                entityCount++;
                            }
                        } catch (e) {
                            logToConsole(`  âš ï¸ ì—”í‹°í‹° ${index} ì²˜ë¦¬ ì‹¤íŒ¨: ${e.message}`, 'warn');
                        }
                    });
                }
                
                scene.add(group);
                logToConsole(`âœ“ ${entityCount}ê°œ ì—”í‹°í‹° ë Œë”ë§ ì™„ë£Œ`, 'success');
                
                // Bounding Box ê³„ì‚° ë° Fit to View
                const box = new THREE.Box3().setFromObject(group);
                if (!box.isEmpty()) {
                    const center = box.getCenter(new THREE.Vector3());
                    const size = box.getSize(new THREE.Vector3());
                    
                    logToConsole(`  ì¤‘ì‹¬: (${center.x.toFixed(2)}, ${center.y.toFixed(2)}, ${center.z.toFixed(2)})`, 'info');
                    logToConsole(`  í¬ê¸°: ${size.x.toFixed(2)} Ã— ${size.y.toFixed(2)}`, 'info');
                    
                    const maxDim = Math.max(size.x, size.y);
                    const viewSize = maxDim * 0.6;
                    const aspect = canvas.clientWidth / canvas.clientHeight;
                    
                    camera.left = -viewSize * aspect;
                    camera.right = viewSize * aspect;
                    camera.top = viewSize;
                    camera.bottom = -viewSize;
                    camera.position.set(center.x, center.y, 100);
                    camera.updateProjectionMatrix();
                    
                    logToConsole('âœ“ ì¹´ë©”ë¼ ì¡°ì • ì™„ë£Œ (Fit to View)', 'success');
                }
                
                // ë Œë”ë§
                renderer.render(scene, camera);
                logToConsole('âœ“ ìµœì¢… ë Œë”ë§ ì™„ë£Œ', 'success');
                
            } catch (error) {
                logToConsole('âŒ ë Œë”ë§ ì‹¤íŒ¨: ' + error.message, 'error');
                throw error;
            }
        }

        // ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        async function testAll() {
            clearConsole();
            logToConsole('ğŸš€ ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹œì‘', 'info');
            await testLibraries();
            logToConsole('ğŸ’¡ DXF íŒŒì¼ì„ ì„ íƒí•˜ì—¬ íŒŒì‹± í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ì„¸ìš”.', 'info');
        }

        // ì‹œìŠ¤í…œ ì •ë³´
        function displaySystemInfo() {
            const info = {
                'User Agent': navigator.userAgent,
                'Platform': navigator.platform,
                'Browser': getBrowserInfo(),
                'Screen': `${window.screen.width}x${window.screen.height}`,
                'Window': `${window.innerWidth}x${window.innerHeight}`,
                'WebGL': isWebGLAvailable() ? 'ì§€ì›ë¨' : 'ë¯¸ì§€ì›',
                'LocalStorage': typeof(Storage) !== 'undefined' ? 'ì§€ì›ë¨' : 'ë¯¸ì§€ì›',
                'ServiceWorker': 'serviceWorker' in navigator ? 'ì§€ì›ë¨' : 'ë¯¸ì§€ì›',
                'Cache API': 'caches' in window ? 'ì§€ì›ë¨' : 'ë¯¸ì§€ì›',
                'Current Time': new Date().toLocaleString('ko-KR')
            };
            
            document.getElementById('systemInfo').textContent = 
                JSON.stringify(info, null, 2);
        }

        function getBrowserInfo() {
            const ua = navigator.userAgent;
            if (ua.indexOf('Chrome') > -1) return 'Chrome';
            if (ua.indexOf('Safari') > -1) return 'Safari';
            if (ua.indexOf('Firefox') > -1) return 'Firefox';
            if (ua.indexOf('MSIE') > -1 || ua.indexOf('Trident') > -1) return 'IE';
            return 'Unknown';
        }

        function isWebGLAvailable() {
            try {
                const canvas = document.createElement('canvas');
                return !!(canvas.getContext('webgl') || canvas.getContext('experimental-webgl'));
            } catch (e) {
                return false;
            }
        }

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­
        const fileUpload = document.querySelector('.file-upload');
        
        fileUpload.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUpload.style.borderColor = '#2196F3';
            fileUpload.style.background = '#e3f2fd';
        });
        
        fileUpload.addEventListener('dragleave', (e) => {
            e.preventDefault();
            fileUpload.style.borderColor = '#ccc';
            fileUpload.style.background = 'transparent';
        });
        
        fileUpload.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUpload.style.borderColor = '#ccc';
            fileUpload.style.background = 'transparent';
            
            const file = e.dataTransfer.files[0];
            if (file && file.name.endsWith('.dxf')) {
                loadDxfFile(file);
            } else {
                logToConsole('âŒ DXF íŒŒì¼ë§Œ ì§€ì›í•©ë‹ˆë‹¤.', 'error');
            }
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
        window.addEventListener('load', () => {
            logToConsole('ğŸ‰ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ', 'success');
            displaySystemInfo();
            setTimeout(testLibraries, 1000);
        });

        // ì—ëŸ¬ ìºì¹˜
        window.addEventListener('error', (event) => {
            logToConsole('ğŸ”´ ì „ì—­ ì—ëŸ¬: ' + event.message, 'error');
            logToConsole('  íŒŒì¼: ' + event.filename, 'error');
            logToConsole('  ë¼ì¸: ' + event.lineno + ':' + event.colno, 'error');
        });

        window.addEventListener('unhandledrejection', (event) => {
            logToConsole('ğŸ”´ Promise ì—ëŸ¬: ' + event.reason, 'error');
        });
    </script>
</body>
</html>

