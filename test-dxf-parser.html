<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DXF Parser ë¹„êµ í…ŒìŠ¤íŠ¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        h1 {
            color: #2196F3;
            margin-bottom: 20px;
            border-bottom: 3px solid #2196F3;
            padding-bottom: 10px;
        }

        h2 {
            color: #333;
            margin-top: 30px;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .parser-box {
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 20px;
        }

        .parser-box.three-dxf {
            border-color: #ff9800;
        }

        .parser-box.dxf-parser {
            border-color: #4caf50;
        }

        .parser-box h3 {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid currentColor;
        }

        .parser-box.three-dxf h3 {
            color: #ff9800;
        }

        .parser-box.dxf-parser h3 {
            color: #4caf50;
        }

        .status {
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .status.success {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .status.error {
            background: #ffebee;
            color: #c62828;
        }

        .status.loading {
            background: #fff3e0;
            color: #ef6c00;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #2196F3;
            color: white;
        }

        .btn-primary:hover {
            background: #1976D2;
        }

        .btn-orange {
            background: #ff9800;
            color: white;
        }

        .btn-orange:hover {
            background: #f57c00;
        }

        .btn-green {
            background: #4caf50;
            color: white;
        }

        .btn-green:hover {
            background: #388e3c;
        }

        #console {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 500px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .log-entry {
            margin-bottom: 6px;
            padding: 3px 0;
        }

        .log-time {
            color: #858585;
            margin-right: 10px;
        }

        .log-info {
            color: #4fc3f7;
        }

        .log-success {
            color: #81c784;
        }

        .log-error {
            color: #e57373;
        }

        .log-warn {
            color: #ffb74d;
        }

        .file-upload {
            margin: 20px 0;
            padding: 20px;
            border: 2px dashed #ccc;
            border-radius: 6px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .file-upload:hover {
            border-color: #2196F3;
            background: #f0f8ff;
        }

        .file-upload input {
            display: none;
        }

        .viewer-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .viewer {
            width: 100%;
            height: 400px;
            background: #1a1a1a;
            border-radius: 6px;
            border: 2px solid #333;
        }

        canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .clear-console {
            float: right;
            padding: 5px 15px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .info-box h4 {
            margin-bottom: 10px;
            color: #1976D2;
        }

        .info-box ul {
            margin-left: 20px;
        }

        .info-box li {
            margin-bottom: 5px;
        }

        .cdn-info {
            background: #f9f9f9;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”¬ DXF Parser ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¹„êµ í…ŒìŠ¤íŠ¸</h1>

        <div class="info-box">
            <h4>ğŸ“š two-dxf vs dxf-parser</h4>
            <ul>
                <li><strong>three-dxf</strong>: Three.jsì™€ í†µí•©ëœ DXF ë·°ì–´ (3D ë Œë”ë§ í¬í•¨)</li>
                <li><strong>dxf-parser</strong>: ìˆœìˆ˜ DXF íŒŒì„œ (JavaScript ê°ì²´ë¡œ ë³€í™˜, ë Œë”ë§ì€ ì§ì ‘ êµ¬í˜„)</li>
                <li>three-dxf CDN ë¡œë”© ì‹¤íŒ¨ ì‹œ dxf-parserë¥¼ ëŒ€ì•ˆìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥</li>
            </ul>
        </div>

        <div class="comparison">
            <div class="parser-box three-dxf">
                <h3>ğŸ“¦ three-dxf (ê¸°ì¡´ ë°©ì‹)</h3>
                <div id="threeDxfStatus" class="status loading">í™•ì¸ ì¤‘...</div>
                <div class="cdn-info">
                    CDN: https://cdn.jsdelivr.net/npm/three-dxf@3.1.6/dist/three-dxf.umd.js
                </div>
                <button class="btn-orange" onclick="testThreeDxf()">three-dxf í…ŒìŠ¤íŠ¸</button>
            </div>

            <div class="parser-box dxf-parser">
                <h3>ğŸ”§ dxf-parser (ëŒ€ì•ˆ)</h3>
                <div id="dxfParserStatus" class="status loading">í™•ì¸ ì¤‘...</div>
                <div class="cdn-info">
                    CDN: https://cdn.jsdelivr.net/npm/dxf-parser@1.2.2/dist/dxf-parser.min.js
                </div>
                <button class="btn-green" onclick="testDxfParser()">dxf-parser í…ŒìŠ¤íŠ¸</button>
            </div>
        </div>

        <div class="button-group">
            <button class="btn-primary" onclick="testBothParsers()">ğŸ§ª ë‘ íŒŒì„œ ëª¨ë‘ í…ŒìŠ¤íŠ¸</button>
            <button class="btn-primary" onclick="location.reload()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        </div>

        <h2>ğŸ“ DXF íŒŒì¼ ì„ íƒ</h2>
        <div class="file-upload" onclick="document.getElementById('dxfInput').click()">
            <p>ğŸ“„ DXF íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì„¸ìš”</p>
            <input type="file" id="dxfInput" accept=".dxf" onchange="loadDxfFile(this.files[0])">
        </div>

        <h2>ğŸ–¥ï¸ ì½˜ì†” ë¡œê·¸</h2>
        <button class="clear-console" onclick="clearConsole()">ë¡œê·¸ ì§€ìš°ê¸°</button>
        <div id="console"></div>

        <h2>ğŸ“Š ë Œë”ë§ ë¹„êµ</h2>
        <div class="viewer-container">
            <div>
                <h3 style="text-align: center; margin-bottom: 10px; color: #ff9800;">three-dxf ë Œë”ë§</h3>
                <div class="viewer">
                    <canvas id="threeDxfCanvas"></canvas>
                </div>
            </div>
            <div>
                <h3 style="text-align: center; margin-bottom: 10px; color: #4caf50;">dxf-parser ë Œë”ë§</h3>
                <div class="viewer">
                    <canvas id="dxfParserCanvas"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Three.js (ì–‘ìª½ ëª¨ë‘ í•„ìš”) -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.min.js"></script>

    <!-- three-dxf (ê¸°ì¡´ ë°©ì‹) -->
    <script src="https://cdn.jsdelivr.net/npm/three-dxf@3.1.6/dist/three-dxf.umd.js"></script>

    <!-- dxf-parser (ëŒ€ì•ˆ) - ì—¬ëŸ¬ CDN ì‹œë„ -->
    <script src="https://cdn.jsdelivr.net/npm/dxf-parser@1.2.2/dist/dxf-parser.min.js"></script>

    <script>
        // ì½˜ì†” ë¡œê¹…
        const consoleElement = document.getElementById('console');

        function logToConsole(message, type = 'info') {
            const time = new Date().toLocaleTimeString('ko-KR');
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            
            logEntry.innerHTML = `
                <span class="log-time">[${time}]</span>
                <span class="log-${type}">${escapeHtml(String(message))}</span>
            `;
            
            consoleElement.appendChild(logEntry);
            consoleElement.scrollTop = consoleElement.scrollHeight;
        }

        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        function clearConsole() {
            consoleElement.innerHTML = '';
            logToConsole('ì½˜ì†”ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        }

        // three-dxf í…ŒìŠ¤íŠ¸
        function testThreeDxf() {
            logToConsole('=== three-dxf í…ŒìŠ¤íŠ¸ ì‹œì‘ ===', 'info');
            const statusEl = document.getElementById('threeDxfStatus');

            if (typeof ThreeDxf !== 'undefined') {
                statusEl.className = 'status success';
                statusEl.textContent = 'âœ“ ë¡œë“œ ì„±ê³µ';
                logToConsole('âœ“ three-dxf ë¡œë“œ ì„±ê³µ', 'success');

                try {
                    const parser = new ThreeDxf.Parser();
                    logToConsole('âœ“ ThreeDxf.Parser ìƒì„± ì„±ê³µ', 'success');
                    logToConsole(`  ì‚¬ìš© ê°€ëŠ¥í•œ ë©”ì„œë“œ: ${Object.getOwnPropertyNames(Object.getPrototypeOf(parser)).join(', ')}`, 'info');
                } catch (e) {
                    logToConsole('âŒ Parser ìƒì„± ì‹¤íŒ¨: ' + e.message, 'error');
                    statusEl.className = 'status error';
                    statusEl.textContent = 'âŒ Parser ìƒì„± ì‹¤íŒ¨';
                }
            } else {
                statusEl.className = 'status error';
                statusEl.textContent = 'âŒ ë¡œë“œ ì‹¤íŒ¨';
                logToConsole('âŒ three-dxf ë¡œë“œ ì‹¤íŒ¨', 'error');
                logToConsole('  window.ThreeDxf = ' + typeof window.ThreeDxf, 'error');
                logToConsole('  ëŒ€ì•ˆ: dxf-parser ì‚¬ìš©ì„ ê¶Œì¥í•©ë‹ˆë‹¤', 'warn');
            }
        }

        // dxf-parser í…ŒìŠ¤íŠ¸
        function testDxfParser() {
            logToConsole('=== dxf-parser í…ŒìŠ¤íŠ¸ ì‹œì‘ ===', 'info');
            const statusEl = document.getElementById('dxfParserStatus');

            // ì—¬ëŸ¬ ê°€ëŠ¥í•œ ë³€ìˆ˜ëª… í™•ì¸
            const DxfParser = window.DxfParser || window.dxfParser;

            if (typeof DxfParser !== 'undefined') {
                statusEl.className = 'status success';
                statusEl.textContent = 'âœ“ ë¡œë“œ ì„±ê³µ';
                logToConsole('âœ“ dxf-parser ë¡œë“œ ì„±ê³µ', 'success');

                try {
                    const parser = new DxfParser();
                    logToConsole('âœ“ DxfParser ìƒì„± ì„±ê³µ', 'success');
                    logToConsole(`  ì‚¬ìš© ê°€ëŠ¥í•œ ë©”ì„œë“œ: ${Object.getOwnPropertyNames(Object.getPrototypeOf(parser)).join(', ')}`, 'info');
                } catch (e) {
                    logToConsole('âŒ Parser ìƒì„± ì‹¤íŒ¨: ' + e.message, 'error');
                    statusEl.className = 'status error';
                    statusEl.textContent = 'âŒ Parser ìƒì„± ì‹¤íŒ¨';
                }
            } else {
                statusEl.className = 'status error';
                statusEl.textContent = 'âŒ ë¡œë“œ ì‹¤íŒ¨ - npm ì„¤ì¹˜ í•„ìš”';
                logToConsole('âŒ dxf-parser ë¡œë“œ ì‹¤íŒ¨', 'error');
                logToConsole('  CDN ë²„ì „ì´ ì—†ìŠµë‹ˆë‹¤. npmìœ¼ë¡œ ì„¤ì¹˜í•˜ê³  ë²ˆë“¤ë§ í•„ìš”', 'warn');
                logToConsole('  ì„¤ì¹˜: npm install dxf-parser', 'info');
            }
        }

        // ë‘ íŒŒì„œ ëª¨ë‘ í…ŒìŠ¤íŠ¸
        async function testBothParsers() {
            clearConsole();
            logToConsole('ğŸš€ ì „ì²´ ë¼ì´ë¸ŒëŸ¬ë¦¬ í…ŒìŠ¤íŠ¸ ì‹œì‘', 'info');
            
            // Three.js í™•ì¸
            if (typeof THREE !== 'undefined') {
                logToConsole(`âœ“ Three.js ë¡œë“œ ì„±ê³µ (r${THREE.REVISION})`, 'success');
            } else {
                logToConsole('âŒ Three.js ë¡œë“œ ì‹¤íŒ¨', 'error');
            }

            await new Promise(resolve => setTimeout(resolve, 500));
            testThreeDxf();
            
            await new Promise(resolve => setTimeout(resolve, 500));
            testDxfParser();

            logToConsole('ğŸ’¡ DXF íŒŒì¼ì„ ì„ íƒí•˜ì—¬ íŒŒì‹± í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ì„¸ìš”.', 'info');
        }

        // DXF íŒŒì¼ ë¡œë“œ
        let currentDxfText = null;

        async function loadDxfFile(file) {
            if (!file) {
                logToConsole('âŒ íŒŒì¼ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            logToConsole(`=== DXF íŒŒì¼ ë¡œë“œ: ${file.name} ===`, 'info');
            logToConsole(`  íŒŒì¼ í¬ê¸°: ${(file.size / 1024).toFixed(2)} KB`, 'info');

            try {
                currentDxfText = await file.text();
                logToConsole(`âœ“ íŒŒì¼ ì½ê¸° ì™„ë£Œ (${currentDxfText.length} ë¬¸ì)`, 'success');

                // ë‘ íŒŒì„œë¡œ ê°ê° í…ŒìŠ¤íŠ¸
                await parseWithThreeDxf(currentDxfText);
                await parseWithDxfParser(currentDxfText);

            } catch (error) {
                logToConsole('âŒ íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨: ' + error.message, 'error');
            }
        }

        // three-dxfë¡œ íŒŒì‹±
        async function parseWithThreeDxf(dxfText) {
            logToConsole('--- three-dxfë¡œ íŒŒì‹± ì‹œë„ ---', 'info');

            if (typeof ThreeDxf === 'undefined') {
                logToConsole('âš ï¸ three-dxfê°€ ë¡œë“œë˜ì§€ ì•ŠìŒ', 'warn');
                return;
            }

            try {
                const parser = new ThreeDxf.Parser();
                const dxf = parser.parseSync(dxfText);
                
                logToConsole('âœ“ three-dxf íŒŒì‹± ì„±ê³µ', 'success');
                logToConsole(`  ì—”í‹°í‹° ìˆ˜: ${dxf.entities ? dxf.entities.length : 0}`, 'info');

                // ë Œë”ë§
                renderWithThreeDxf(dxf);

            } catch (error) {
                logToConsole('âŒ three-dxf íŒŒì‹± ì‹¤íŒ¨: ' + error.message, 'error');
            }
        }

        // dxf-parserë¡œ íŒŒì‹±
        async function parseWithDxfParser(dxfText) {
            logToConsole('--- dxf-parserë¡œ íŒŒì‹± ì‹œë„ ---', 'info');

            const DxfParser = window.DxfParser || window.dxfParser;

            if (typeof DxfParser === 'undefined') {
                logToConsole('âš ï¸ dxf-parserê°€ ë¡œë“œë˜ì§€ ì•ŠìŒ (CDN ë²„ì „ ì—†ìŒ)', 'warn');
                logToConsole('  npm install dxf-parser í›„ ë²ˆë“¤ë§ í•„ìš”', 'info');
                return;
            }

            try {
                const parser = new DxfParser();
                const dxf = parser.parseSync(dxfText);
                
                logToConsole('âœ“ dxf-parser íŒŒì‹± ì„±ê³µ', 'success');
                logToConsole(`  ì—”í‹°í‹° ìˆ˜: ${dxf.entities ? dxf.entities.length : 0}`, 'info');
                logToConsole(`  êµ¬ì¡°: ${JSON.stringify(Object.keys(dxf), null, 2)}`, 'info');

                // ë Œë”ë§
                renderWithDxfParser(dxf);

            } catch (error) {
                logToConsole('âŒ dxf-parser íŒŒì‹± ì‹¤íŒ¨: ' + error.message, 'error');
            }
        }

        // three-dxf ë Œë”ë§
        function renderWithThreeDxf(dxf) {
            try {
                const canvas = document.getElementById('threeDxfCanvas');
                const scene = new THREE.Scene();
                scene.background = new THREE.Color(0x1a1a1a);

                const camera = new THREE.OrthographicCamera(-100, 100, 100, -100, 0.1, 1000);
                camera.position.set(0, 0, 100);

                const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
                renderer.setSize(canvas.clientWidth, canvas.clientHeight);

                const group = new THREE.Group();
                let count = 0;

                if (dxf.entities) {
                    dxf.entities.forEach(entity => {
                        if (entity.vertices && entity.vertices.length > 0) {
                            const geometry = new THREE.BufferGeometry();
                            const positions = [];
                            
                            entity.vertices.forEach(v => {
                                positions.push(v.x, v.y, v.z || 0);
                            });
                            
                            geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
                            const material = new THREE.LineBasicMaterial({ color: 0xffffff });
                            const line = new THREE.Line(geometry, material);
                            group.add(line);
                            count++;
                        }
                    });
                }

                scene.add(group);

                // Fit to view
                const box = new THREE.Box3().setFromObject(group);
                if (!box.isEmpty()) {
                    const center = box.getCenter(new THREE.Vector3());
                    const size = box.getSize(new THREE.Vector3());
                    const maxDim = Math.max(size.x, size.y) * 0.6;
                    const aspect = canvas.clientWidth / canvas.clientHeight;
                    
                    camera.left = -maxDim * aspect;
                    camera.right = maxDim * aspect;
                    camera.top = maxDim;
                    camera.bottom = -maxDim;
                    camera.position.set(center.x, center.y, 100);
                    camera.updateProjectionMatrix();
                }

                renderer.render(scene, camera);
                logToConsole(`âœ“ three-dxf ë Œë”ë§ ì™„ë£Œ (${count}ê°œ ì—”í‹°í‹°)`, 'success');

            } catch (error) {
                logToConsole('âŒ three-dxf ë Œë”ë§ ì‹¤íŒ¨: ' + error.message, 'error');
            }
        }

        // dxf-parser ë Œë”ë§ (ìˆ˜ë™ êµ¬í˜„)
        function renderWithDxfParser(dxf) {
            try {
                const canvas = document.getElementById('dxfParserCanvas');
                const scene = new THREE.Scene();
                scene.background = new THREE.Color(0x1a1a1a);

                const camera = new THREE.OrthographicCamera(-100, 100, 100, -100, 0.1, 1000);
                camera.position.set(0, 0, 100);

                const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
                renderer.setSize(canvas.clientWidth, canvas.clientHeight);

                const group = new THREE.Group();
                let count = 0;

                // dxf-parserì˜ ì—”í‹°í‹° êµ¬ì¡°ì— ë§ê²Œ ë Œë”ë§
                if (dxf.entities) {
                    Object.keys(dxf.entities).forEach(type => {
                        const entities = dxf.entities[type];
                        if (!Array.isArray(entities)) return;

                        entities.forEach(entity => {
                            if (type === 'LINE') {
                                const geometry = new THREE.BufferGeometry();
                                const positions = [
                                    entity.start.x, entity.start.y, entity.start.z || 0,
                                    entity.end.x, entity.end.y, entity.end.z || 0
                                ];
                                geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
                                const material = new THREE.LineBasicMaterial({ color: 0xffffff });
                                const line = new THREE.Line(geometry, material);
                                group.add(line);
                                count++;
                            }
                            // ë‹¤ë¥¸ ì—”í‹°í‹° íƒ€ì…ë„ ì²˜ë¦¬ ê°€ëŠ¥
                        });
                    });
                }

                scene.add(group);

                // Fit to view
                const box = new THREE.Box3().setFromObject(group);
                if (!box.isEmpty()) {
                    const center = box.getCenter(new THREE.Vector3());
                    const size = box.getSize(new THREE.Vector3());
                    const maxDim = Math.max(size.x, size.y) * 0.6;
                    const aspect = canvas.clientWidth / canvas.clientHeight;
                    
                    camera.left = -maxDim * aspect;
                    camera.right = maxDim * aspect;
                    camera.top = maxDim;
                    camera.bottom = -maxDim;
                    camera.position.set(center.x, center.y, 100);
                    camera.updateProjectionMatrix();
                }

                renderer.render(scene, camera);
                logToConsole(`âœ“ dxf-parser ë Œë”ë§ ì™„ë£Œ (${count}ê°œ ì—”í‹°í‹°)`, 'success');

            } catch (error) {
                logToConsole('âŒ dxf-parser ë Œë”ë§ ì‹¤íŒ¨: ' + error.message, 'error');
            }
        }

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­
        const fileUpload = document.querySelector('.file-upload');
        
        fileUpload.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUpload.style.borderColor = '#2196F3';
        });
        
        fileUpload.addEventListener('dragleave', (e) => {
            e.preventDefault();
            fileUpload.style.borderColor = '#ccc';
        });
        
        fileUpload.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUpload.style.borderColor = '#ccc';
            
            const file = e.dataTransfer.files[0];
            if (file && file.name.endsWith('.dxf')) {
                loadDxfFile(file);
            }
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í…ŒìŠ¤íŠ¸
        window.addEventListener('load', () => {
            logToConsole('ğŸ‰ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ', 'success');
            setTimeout(testBothParsers, 1000);
        });
    </script>
</body>
</html>

