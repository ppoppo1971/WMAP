<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>DXF 현장 조사 앱</title>
    
    <!-- 스타일시트 -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Three.js 라이브러리 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- three-dxf 라이브러리 -->
    <script src="https://cdn.jsdelivr.net/npm/three-dxf@2.2.1/dist/three-dxf.min.js"></script>
    
    <!-- Google API Client -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
    <!-- 로딩 화면 -->
    <div id="loading-screen" class="loading-screen">
        <div class="spinner"></div>
        <p>로딩 중...</p>
    </div>

    <!-- 메인 컨테이너 -->
    <div id="app-container" class="app-container">
        
        <!-- 상단 툴바 -->
        <div id="toolbar" class="toolbar">
            <button id="login-btn" class="toolbar-btn">
                <span>🔐 로그인</span>
            </button>
            <button id="open-file-btn" class="toolbar-btn" disabled>
                <span>📂 파일 열기</span>
            </button>
            <button id="zoom-fit-btn" class="toolbar-btn" disabled>
                <span>🔍 전체보기</span>
            </button>
            <div class="toolbar-spacer"></div>
            <div id="user-info" class="user-info" style="display: none;">
                <img id="user-avatar" class="user-avatar" src="" alt="">
                <span id="user-name"></span>
            </div>
        </div>

        <!-- DXF 뷰어 캔버스 -->
        <div id="viewer-container" class="viewer-container">
            <canvas id="dxf-canvas"></canvas>
            
            <!-- 마커 컨테이너 (사진 이모지들이 표시될 곳) -->
            <div id="markers-container" class="markers-container"></div>
            
            <!-- 안내 메시지 -->
            <div id="welcome-message" class="welcome-message">
                <h2>📐 DXF 현장 조사 앱</h2>
                <p>1. 로그인 버튼을 눌러 Google 계정으로 로그인하세요</p>
                <p>2. 파일 열기로 DXF 도면을 선택하세요</p>
                <p>3. 도면에서 롱프레스하여 사진과 메모를 추가하세요</p>
            </div>
        </div>

        <!-- 사진/메모 추가 모달 -->
        <div id="add-photo-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>📷 사진 및 메모 추가</h3>
                    <button id="close-modal-btn" class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <!-- 사진 선택 버튼들 -->
                    <div class="photo-buttons">
                        <button id="camera-btn" class="photo-btn">
                            <span>📸 카메라 촬영</span>
                        </button>
                        <button id="gallery-btn" class="photo-btn">
                            <span>🖼️ 갤러리 선택</span>
                        </button>
                    </div>
                    
                    <!-- 숨겨진 파일 입력 -->
                    <input type="file" id="camera-input" accept="image/*" capture="environment" style="display: none;">
                    <input type="file" id="gallery-input" accept="image/*" style="display: none;">
                    
                    <!-- 사진 미리보기 -->
                    <div id="photo-preview" class="photo-preview" style="display: none;">
                        <img id="preview-image" src="" alt="미리보기">
                    </div>
                    
                    <!-- 메모 입력 -->
                    <div class="memo-input-container">
                        <label for="memo-input">메모:</label>
                        <textarea id="memo-input" class="memo-input" placeholder="메모를 입력하세요..." rows="3"></textarea>
                    </div>
                    
                    <!-- 저장 버튼 -->
                    <button id="save-photo-btn" class="save-btn" disabled>
                        <span>💾 저장</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- 사진 보기 모달 -->
        <div id="view-photo-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>📷 사진 보기</h3>
                    <button id="close-view-modal-btn" class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="photo-view">
                        <img id="view-photo-image" src="" alt="사진">
                    </div>
                    <div class="photo-memo">
                        <strong>메모:</strong>
                        <p id="view-photo-memo"></p>
                    </div>
                    <button id="delete-photo-btn" class="delete-btn">
                        <span>🗑️ 삭제</span>
                    </button>
                </div>
            </div>
        </div>

    </div>

    <!-- JavaScript 파일들 -->
    <script src="google-drive.js"></script>
    <script src="dxf-viewer.js"></script>
    <script src="app.js"></script>
</body>
</html>

